@startuml TokenizeFiscalCode

participant caller
participant TokenizeFiscalCode as tf
participant PDV
collections "key-vault" as kv
participant "ai-common" as ai

caller -> tf : call
activate tf

tf -> tf : Validate fiscal code

break Invalid input
  tf -> ai : Track the error event
  tf -> caller : Throw an error
end

tf -[#green]> kv : Ask for namespace

alt Error from key vault
  kv -[#red]> tf : Error
  tf -> ai : Track the error event
  tf -> caller : Throw an error
end

kv -[#green]> tf : namespace

tf -> PDV : Call tokenizer api

alt Error from PDV
  PDV -[#red]> tf : Error
  tf -> ai : Track the error event
  tf -> caller : Throw an error
end

PDV -[#green]> tf : token
tf -> caller : return tokenized fiscal code

@enduml
